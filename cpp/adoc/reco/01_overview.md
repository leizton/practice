--------------------------------------------------------------------------------------------------------------
# NCF: Neural Collaborative Filtering
what's
  用神经网络这一工具实现协同过滤是在推荐系统中用深度学习技术的最普遍方向之一
  推荐的本质是user和item的匹配问题, 协同过滤的目标就是给出user和item间的匹配score
  协同过滤计算score的方法是计算user特征和item特征的相似值
  简单的特征向量取自评分矩阵, 由于评分矩阵的稀疏, 所以有矩阵分解
  后来矩阵分解变成了dssm双塔模型, 特征向量变成了embedding向量
  在双塔模型中, 依然是用向量点积计算相似分, Xiangnan He 在NCF中提出用MLP代替点积
  原因是有限维数的embedVec仅用点积不能包含大量user/item间的全部关系, 具体参考@ref_1
MLP
  Multi-layer Perception 多层感知机
  理论上能拟合任何函数
  这个说法源于DL二次兴起时代的一篇论文
  Multilayer feedforward networks are universal approximators, 1989
    这篇论文从理论上证明MLP能以任意精度逼近任意可测函数
ref
  1. https://zhuanlan.zhihu.com/p/143161957
  2. https://zhuanlan.zhihu.com/p/160158270


--------------------------------------------------------------------------------------------------------------
# category tag label
category
  category具有排他性, 例如二分类、多分类的机器学习, 排他性使一个事物只能属于一个分类, 但实际情况不是这样
  例如一篇文章主题是中国历史上第一个奥运冠军来自射击, 这个item既可以是历史类, 又可以是体育类
  又如鸭嘴兽既是哺乳动物又是卵生动物, 所以c++引入了多重继承来解决事物包含不同类的属性
tag
  tag是附加给事物的标签(属性、特征)
  例如 item1={tagA,tagB}, item2={tagC,tagD}, 此时 item1 item2 可以分到不同类中
  但如果来了一个item3={tagA,tagC}，分类方法就有问题
  分类比打标签的优势在于类目数量少于tag数量
  基于cate和tag都可以归纳出分层结构, 如{生物->动物->哺乳动物}
label
  事物自身固有的属性, 不会随外部评判标准改变而改变
  例如 这张长1米的桌子是欧式风格. 长1米是label, 欧式风格是tag
  对欧式风格有不同理解的人可能认为这张桌子不是欧式, 但所有人都确定桌子长度是1米


--------------------------------------------------------------------------------------------------------------
# 多样性
@ref https://zhuanlan.zhihu.com/p/264652162
协同过滤在用于提升匹配的精准性时, 没有考虑多样性, 因此会导致用户兴趣狭窄
  不过一刷以内过度多样, 也会导致思维跳跃
  多样性对人均点击、时长等核心指标有帮助, 可以对比专卖店和超市
排序中ctr或cvr(转化率)预估是单点最优预测(point-wise), 但实际给到用户的是一个列表(list-wise 组合优化)
  `本质上是point-wise和list-wise之间有gap`
  避免精度的过拟合
推荐系统核心流程: 召回 精排(ctr cvr 预估) 重排. 为了增强多样性, 通常`在各阶段采用不同的改进策略`
  1. 决定效果上限的召回阶段采用多路召回, 即扩召回降精准
  2. 重排的优化策略有: MRR(Maximal Marginal Relevance), DPP(Determinantal Point Process)
  多样性没有groudtruth(正确的样本标注), 所以通过A/B实验判断多样性策略的优劣
多样性类型，多样性评估维度
  1. 个体. 目标是找到每个个用户的冷门兴趣
           评价指标：ILS(intra-list similarity)，统计推荐列表item间相似度，ILS越大则多样性越差
  2. 整体. 不同用户的兴趣尽可能不同, 即千人千面
           评价指标：①计算两两用户的推荐列表差异；②覆盖率 对中长尾item的推荐能力
  3. 时序. 和过去的推荐比，现在item的差异
  整体推荐效果：时效、热门、ctr、多样、质量
用户兴趣多样性探索
  用多臂机(MAB multi arm bandit)在多个主题中选择，不同用户的权重不同
重排的多样性策略
  1. 基于规则
    1. 相似去重
    2. 频控
        历史多刷限制
        对有相同属性的item 如作者、类别 在一段时间内限制下发次数
    3. 打散
       ① 最小间隔  同类item最少间隔k个item
       ② 最多次数  一刷内某类item最多m个
       ③ 窗口打散  大小w的窗口内某类item最多m个
                    大小w的窗口最多出(w-1)个 等价于 同类item最多连续出现(w-1)次
                    如 w=4, BAAAA(不满足) => AABAA(满足)
       ④ 分桶打散  按某个指标分散到多个桶中，桶内按精排分排序，再类似归并排序的merge生成列表
                    https://zhuanlan.zhihu.com/p/268363776
                    Airbnb在价格维度打散，返回结果包含和query给出价格接近的几个区间，方便用户比较
    4. 长尾item加权
    > 基于展点
      ① 通过用户近期展现点击历史统计各维度各值的权重，生成特征向量
         初始权重1，每次展现降权乘0.95，每次点击加权乘1.44
      ② 用特征向量和item字段值算出相关分，即 div_score
      ③ 更新排序分，rank_score *= div_score
  2. MMR(Maximal Marginal Relevence) 最大边界相关
      目标函数: MMR = argmax{ dᵢ∈R-S; λ·sim1(dᵢ,Q) - (1-λ)·max{ dⱼ∈S; sim2(dᵢ,dⱼ) } }
        Q: query or user-profile
        R: ranked list of documents, rank后的和Q相关的doc列表
        S: selected docs, 已从R中选到推荐结果里的doc集合
  3. DPP
